{% extends "base.html" %}
{% load bookings %}

{% block content %}
<h2>Events</h2>
<ul>
    {% for event in events %}
    <li>
        <strong>{{ event.title }}</strong> - {{ event.date }} at {{ event.location }}
        <p>{{ event.description }}</p>
        <p>Participants:
            {% for participant in event.participants.all %}
                {{ participant.username }}{% if not forloop.last %}, {% endif %}
            {% empty %}
                No participants yet.
            {% endfor %}
        </p>
        {% if request.user.is_authenticated %}
        <form method="post" action="{% url 'event_rsvp' event.id %}">
            {% csrf_token %}
            {% if request.user in event.participants.all %}
            <button type="submit" name="action" value="cancel">Cancel RSVP</button>
            {% else %}
            <button type="submit" name="action" value="join">Join Event</button>
            {% endif %}
        </form>
        <p>
            <a href="{% url 'event_edit' event.id %}">Edit</a> | 
            <a href="{% url 'event_delete' event.id %}">Delete</a>
        </p>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% endblock %}
